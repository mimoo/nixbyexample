<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nix By Example | &lt;fun&gt;</title>

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <!-- bootstrap icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css">

    <!-- highlightjs -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/monokai-sublime.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>


    <!-- markdown -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>

    <!-- custom style -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;900&display=swap');

        /* reset */
        * {
            box-sizing: border-box;
        }

        p {
            margin-bottom: 0;
        }

        /* body */
        body {
            margin-top: 20px;
            margin-bottom: 60px;
        }

        h1.title {
            padding-left: 24px;
        }

        h1 {
            margin-bottom: 40px;
        }

        /* sidebar */

        .chapters {
            padding: 15px;
            background-color: #dcf0f73d;
        }

        .chapters h2 {
            font-size: 17px;
        }

        .chapters a {
            color: black;
            text-decoration: none;
            border-bottom: 1px black solid;
        }

        /* table */
        .chapter h1 {
            font-size: 30px;
        }

        .filename {
            background-color: white;
        }

        .filename h2 {

            font-size: 15px;
        }

        .explanation_code {
            background-color: #23241f;
            margin-bottom: 60px;
        }

        .explanation_code tr td {
            vertical-align: top;
        }

        .explanation {
            padding: 5px 0 20px;
            width: 500px;
            padding-right: 50px !important;

            background-color: white;
            font-family: 'Roboto', sans-serif;
        }

        /* hljs reset */

        .code {
            width: 500px;
            padding: 5px 0 20px !important;
        }

        table .code:first-child {
            padding-top: 15px !important;
        }

        .code pre {
            margin-bottom: 0 !important;
        }

        .code pre code {
            padding: 0 15px !important;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col col-lg-2">
            </div>

            <div class="col col-lg-10">
                <h1 class="jumbotron p-3 p-md-5 text-white rounded bg-dark">Nix By Examples</h1>
            </div>
        </div>


        <div class="row">
            <div class="col col-lg-2">

                <div class="chapters">
                    
                    
                    <h2>Basics</h2>
                    <ul>
                        

                        

                        

                        

                        <li><a href="basics-setup.html">setup</a></li>

                        

                        

                        

                        
                        

                        

                        <li>hello world</li>

                        

                        
                    </ul>
                    
                    <h2>The Nix Language</h2>
                    <ul>
                        

                        
                        
                        
                        
                        

                        

                        

                        <li><a href="language-repl.html">REPL</a></li>

                        

                        
                    </ul>
                    
                    <h2>Flakes</h2>
                    <ul>
                        

                        

                        

                        

                        <li><a href="flakes-packaging.html">packaging 101</a></li>

                        

                        

                        

                        

                        

                        <li><a href="flakes-devshells.html">devshells</a></li>

                        

                        
                    </ul>
                    
                </div>

            </div>

            <div class="col col-md-10 chapter">

                <div class="container">

                    <h1>hello world</h1>

                    
                    <table class="explanation_code">
                        <tr>
                            <td class="explanation"></td>
                            <td class="filename">
                                <h2><code>console</code></h2>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                To &quot;nixify&quot; a project, it only needs a `flake.nix` file at its root. To create one, you can use the `nix flake new` command.
                            </td>
                            <td class="code">
                                <pre><code class="console">$ nix flake new hello
$ cd hello
$ ls
flake.nix
</code></pre>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                To build a ni  project, you can then use `nix build` which will find the `flake.nix` at the root of the project and build it. Unfortunately, by default mac is not supported.
                            </td>
                            <td class="code">
                                <pre><code class="console">$ nix build
error: flake &apos;path:/Users/davidwong/Desktop/test_nix/hello&apos; does not provide attribute &apos;packages.x86_64-darwin.default&apos; or &apos;defaultPackage.x86_64-darwin&apos;
</code></pre>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                You can also launch a shell that will act as a development environment by running `nix develop`. Unfortunately, this won&apos;t work on mac by default as well.
                            </td>
                            <td class="code">
                                <pre><code class="console">$ hello nix develop
warning: creating lock file &apos;/some/path/hello/flake.lock&apos;
error: flake &apos;path:/some/path/hello&apos; does not provide attribute &apos;devShells.x86_64-darwin.default&apos;, &apos;devShell.x86_64-darwin&apos;, &apos;packages.x86_64-darwin.default&apos; or &apos;defaultPackage.x86_64-darwin&apos;
</code></pre>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                If you are on mac, modify the flake file and replace `linux` with `darwin` and run `nix build` again. You should see two new files: a lock file and a result file symlinking to the built artifacts.
                            </td>
                            <td class="code">
                                <pre><code class="console">$ ls -l
total 16
drwxr-xr-x  5 me  staff   160B Aug  7 14:31 .
drwxr-xr-x  3 me  staff    96B Aug  7 13:40 ..
-rw-r--r--  1 me  staff   508B Aug  7 14:12 flake.lock
-rw-r--r--  1 me  staff   378B Aug  7 14:29 flake.nix
lrwxr-xr-x  1 me  staff    56B Aug  7 14:31 result -&gt; /nix/store/zrm3agz6hqncqbbpmn8v3w70qzzd2wdd-hello-2.12.1
</code></pre>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                In the folder symlinked by the `result` file you can find binaries and outputs produced by the build of the `hello` package.
                            </td>
                            <td class="code">
                                <pre><code class="console">$ /nix/store/zrm3agz6hqncqbbpmn8v3w70qzzd2wdd-hello-2.12.1/bin/hello 
Hello, world!
</code></pre>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                Thix `nix flake show` command shows you what is encoded by the `flake.nix` file.
                            </td>
                            <td class="code">
                                <pre><code class="console">$ nix flake show
path:/some/path/hello?lastModified=1659875514&amp;narHash=sha256-mse3RPTu2OYYM%2fteTK54p6xgO5QpyYRiVdjZgj80%2frQ=
├───defaultPackage
│   ├───x86_64-darwin: package &apos;hello-2.12.1&apos;
│   └───x86_64-linux: package &apos;hello-2.12.1&apos;
└───packages
    ├───x86_64-darwin
    │   └───hello: package &apos;hello-2.12.1&apos;
    └───x86_64-linux
        └───hello: package &apos;hello-2.12.1&apos;</code></pre>
                            </td>
                        </tr>
                        
                    </table>
                    
                    <table class="explanation_code">
                        <tr>
                            <td class="explanation"></td>
                            <td class="filename">
                                <h2><code>flake.nix</code></h2>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                A .nix file is written using the nix language (more on that later).
                            </td>
                            <td class="code">
                                <pre><code class="nix">{
  description = &quot;A very basic flake&quot;;

  outputs = { self, nixpkgs }: {
</code></pre>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                We obtain the `hello` package from [nixpkgs](https://github.com/NixOS/nixpkgs), the place for all softwares that were packaged with nix. Note that `packages` is a list of `packages` we want to package, and it is a special keyword recognized by `nix` (so you can write `nix build#hello`). For this reason, `nixpkgs` had to use a different keyword called  `legacyPackages`.
                            </td>
                            <td class="code">
                                <pre><code class="nix">    packages.x86_64-linux.hello = nixpkgs.legacyPackages.x86_64-linux.hello;
</code></pre>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                the `defaultPackage` points to what `nix build` will build by default. It is a deprecated keyword, which is still used by the nix CLI for some reason. Don&apos;t worry too much about the content of our `flake.nix` for now, you&apos;ll have to learn a bit more about the nix language before we go back to that.
                            </td>
                            <td class="code">
                                <pre><code class="nix">    defaultPackage.x86_64-linux = self.packages.x86_64-linux.hello;

  };
}</code></pre>
                            </td>
                        </tr>
                        
                    </table>
                    
                    <table class="explanation_code">
                        <tr>
                            <td class="explanation"></td>
                            <td class="filename">
                                <h2><code>flake.lock</code></h2>
                            </td>
                        </tr>
                        
                        <tr>
                            <td class="explanation">
                                The `flake.lock` file is created when you build for the first time. It is then used to track the hash of each dependencies you listed, so that they do not change under you in the future.
                            </td>
                            <td class="code">
                                <pre><code class="nix">{
  &quot;nodes&quot;: {
    &quot;nixpkgs&quot;: {
      &quot;locked&quot;: {
        &quot;lastModified&quot;: 1659782844,
        &quot;narHash&quot;: &quot;sha256-tM/qhHFE61puBxh9ebP3BIG1fkRAT4rHqD3jCM0HXGY=&quot;,
        &quot;owner&quot;: &quot;NixOS&quot;,
        &quot;repo&quot;: &quot;nixpkgs&quot;,
        &quot;rev&quot;: &quot;c85e56bb060291eac3fb3c75d4e0e64f6836fcfe&quot;,
        &quot;type&quot;: &quot;github&quot;
      },
      &quot;original&quot;: {
        &quot;id&quot;: &quot;nixpkgs&quot;,
        &quot;type&quot;: &quot;indirect&quot;
      }
    },
    &quot;root&quot;: {
      &quot;inputs&quot;: {
        &quot;nixpkgs&quot;: &quot;nixpkgs&quot;
      }
    }
  },
  &quot;root&quot;: &quot;root&quot;,
  &quot;version&quot;: 7
}</code></pre>
                            </td>
                        </tr>
                        
                    </table>
                    

                    <div style="text-align:right">
                        
                        next: <a href="language-repl.html">REPL</a>
                        
                    </div>

                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container" style="text-align:center">
            This is a work-in-progress. Help the project by <a
                href="https://www.github.com/mimoo/nixbyexample">contributing</a>.
        </div>
    </footer>

    <script>
        // highlight <pre><code>
        hljs.highlightAll();

        // markdown explanations
        var converter = new showdown.Converter();
        let e = document.querySelectorAll(".explanation")
        e.forEach((thing) => {
            let html = converter.makeHtml(thing.innerText)
            thing.innerHTML = html
        })
    </script>

</body>

</html>